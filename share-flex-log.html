<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏ö‡∏∏‡∏ç‡∏ú‡πà‡∏≤‡∏ô LIFF</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background-color: #f7f7f7;
        margin: 0;
        text-align: center;
      }
      .btn-full {
        width: 80%;
        padding: 15px;
        font-size: 18px;
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <h1>‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ö‡∏∏‡∏ç‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</h1>

    <button id="shareButton" class="btn btn-success btn-full">
      üì§ ‡πÅ‡∏ä‡∏£‡πå Flex Message
    </button>

    <button id="testLogButton" class="btn btn-outline-primary btn-full">
      üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á Flex)
    </button>

    <script>
      const webhookUrl =
        "https://script.google.com/macros/s/AKfycbxCkj-3cM9tSU_IWosWOlGX3FZJqojmRxz3h_hyoqCP0n62k_1_pjhr1BZwis_2zW5L/exec";

      async function logShareToSheet(status) {
        try {
          const profile = await liff.getProfile();
          await fetch(webhookUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              status: status,
              displayName: profile.displayName,
              userId: profile.userId,
              pictureUrl: profile.pictureUrl,
            }),
          });
        } catch (e) {
          console.error("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log:", e);
        }
      }

      async function main() {
        try {
          await liff.init({ liffId: "1661018679-Y47yR00l" });

          if (!liff.isLoggedIn()) {
            liff.login();
            return;
          }

          await liff.ready;

          document
            .getElementById("shareButton")
            .addEventListener("click", async () => {
              if (!liff.isApiAvailable("shareTargetPicker")) {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ");
                return;
              }

              const flexMessage = {
                type: "flex",
                altText:
                  "‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏ö‡∏∏‡∏ç ‡∏û‡∏¥‡∏ò‡∏µ‡∏ó‡∏≠‡∏î‡∏ú‡πâ‡∏≤‡∏õ‡πà‡∏≤‡∏â‡∏•‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 16 ‡∏õ‡∏µ ‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡∏ò‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏¢‡πÑ‡∏ã‡∏ï‡∏∞‡∏°‡∏∞",
                contents: {
                  type: "bubble",
                  hero: {
                    type: "image",
                    url: "https://voom-obs.line-scdn.net/r/myhome/hex/cj02cG5vbWlnMzM4MTA1JnM9anA3JnQ9ZCZ1PTFlcGY5YzBkMDNpMDAmaT0w/m612x918",
                    size: "full",
                    aspectRatio: "1:1.4",
                    aspectMode: "cover",
                    backgroundColor: "#FFFFFFFF",
                    action: {
                      type: "uri",
                      label: "‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°",
                      uri: "https://linevoom.line.me/post/1172735114495047902",
                    },
                  },
                  body: {
                    type: "box",
                    layout: "vertical",
                    backgroundColor: "#FFFDEEFF",
                    contents: [
                      {
                        type: "text",
                        text: "‡∏û‡∏¥‡∏ò‡∏µ‡∏ó‡∏≠‡∏î‡∏ú‡πâ‡∏≤‡∏õ‡πà‡∏≤‡∏â‡∏•‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 16 ‡∏õ‡∏µ",
                        weight: "bold",
                        size: "lg",
                        color: "#C92041FF",
                        align: "center",
                      },
                      {
                        type: "text",
                        text: "‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡∏ò‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏¢‡πÑ‡∏ã‡∏ï‡∏∞‡∏°‡∏∞",
                        size: "lg",
                        color: "#C92041FF",
                        align: "center",
                      },
                      {
                        type: "box",
                        layout: "vertical",
                        spacing: "sm",
                        margin: "lg",
                        contents: [
                          {
                            type: "box",
                            layout: "baseline",
                            spacing: "sm",
                            contents: [
                              {
                                type: "text",
                                text: "üìç",
                                size: "sm",
                                flex: 1,
                                color: "#888888",
                              },
                              {
                                type: "text",
                                text: "269-2 Nishimotojuku, Higashimatsuyama, Saitama",
                                size: "sm",
                                color: "#2C54D3FF",
                                flex: 10,
                                wrap: true,
                              },
                            ],
                          },
                          {
                            type: "box",
                            layout: "baseline",
                            spacing: "sm",
                            contents: [
                              {
                                type: "text",
                                text: "üï•",
                                size: "sm",
                                flex: 1,
                                color: "#888888",
                              },
                              {
                                type: "text",
                                text: "10:00 - 15:00",
                                size: "sm",
                                color: "#0E128CFF",
                                flex: 10,
                                wrap: true,
                              },
                            ],
                          },
                        ],
                      },
                    ],
                  },
                  footer: {
                    type: "box",
                    layout: "vertical",
                    spacing: "sm",
                    contents: [
                      {
                        type: "button",
                        action: {
                          type: "uri",
                          label: "‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°",
                          uri: "https://linevoom.line.me/post/1172735114495047902",
                        },
                        style: "primary",
                      },
                      {
                        type: "button",
                        action: {
                          type: "uri",
                          label: "‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏ö‡∏∏‡∏ç",
                          uri: "https://liff.line.me/1661018679-3gpyeQQk",
                        },
                        color: "#FF8B3DFF",
                        style: "primary",
                      },
                      { type: "spacer", size: "sm" },
                    ],
                  },
                },
              };

              try {
                const result = await liff.shareTargetPicker([flexMessage]);
                if (result) {
                  console.log("‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");
                  await logShareToSheet("‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                  setTimeout(() => liff.closeWindow(), 1500);
                } else {
                  console.log("‚ùå ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å");
                  await logShareToSheet("‚ùå ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å");
                }
              } catch (error) {
                console.error("‚ùå ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", error);
                await logShareToSheet("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
              }
            });

          // üîß ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö log
          document
            .getElementById("testLogButton")
            .addEventListener("click", async () => {
              await logShareToSheet("üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log");
              alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡πÅ‡∏•‡πâ‡∏ß");
            });
        } catch (err) {
          console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡πÇ‡∏´‡∏•‡∏î LIFF:", err);
        }
      }

      document.addEventListener("DOMContentLoaded", main);
    </script>
  </body>
</html>

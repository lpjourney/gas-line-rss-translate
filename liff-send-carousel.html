
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üì¢ ‡∏™‡πà‡∏á Carousel Flex ‡∏ú‡πà‡∏≤‡∏ô LIFF</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
      margin: auto;
      max-width: 800px;
    }
    h2 {
      color: #2c7a7b;
    }
    .news-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }
    .news-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      padding: 12px;
      display: flex;
      flex-direction: column;
    }
    .news-card input {
      margin-right: 8px;
    }
    .news-card img {
      margin-top: 8px;
      border-radius: 8px;
      max-width: 100%;
      object-fit: cover;
    }
    .news-title {
      font-weight: bold;
      font-size: 1.05rem;
      margin-bottom: 4px;
    }
    .news-desc {
      color: #555;
      font-size: 0.9rem;
    }
    button {
      margin-top: 25px;
      padding: 12px;
      font-size: 1.05rem;
      border: none;
      background: #2f855a;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>üì¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πà‡∏≤‡∏ß ‚Üí ‡∏™‡πà‡∏á Flex ‡πÅ‡∏ö‡∏ö Carousel</h2>
  <div id="newsList" class="news-list">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß...</div>
  <button onclick="sendCarousel()">üöÄ ‡∏™‡πà‡∏á Carousel Flex</button>
  <div id="status"></div>

  <script>
    const api = "https://script.google.com/macros/s/AKfycbzIeh-8ONQAbklb1yYDlOpiME28qL44LFeySxiRIrY6Py5YFEwCPeYhqYM3QujdShYbYw/exec";
    let newsData = [];

    async function fetchNews() {
      const res = await fetch(api + "?preview=1");
      newsData = await res.json();
      const list = document.getElementById("newsList");
      list.innerHTML = "";

      newsData.forEach((item, i) => {
        const box = document.createElement("div");
        box.className = "news-card";
        const label = document.createElement("label");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = i;

        const title = document.createElement("div");
        title.className = "news-title";
        title.textContent = item.title;

        const desc = document.createElement("div");
        desc.className = "news-desc";
        desc.textContent = item.translated.slice(0, 100) + "...";

        const img = document.createElement("img");
        img.src = item.image || "https://your-default-image.com/default.jpg";

        label.appendChild(checkbox);
        label.appendChild(title);
        label.appendChild(desc);
        label.appendChild(img);
        box.appendChild(label);
        list.appendChild(box);
      });
    }

    window.sendCarousel = async function () {
      const selected = [...document.querySelectorAll("input[type='checkbox']:checked")].map(cb => newsData[cb.value]);
      if (selected.length === 0) {
        document.getElementById("status").textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
        return;
      }

      const bubbles = selected.slice(0, 10).map(item => ({
        type: "bubble",
        hero: {
          type: "image",
          url: item.image || "https://your-default-image.com/default.jpg",
          size: "full",
          aspectRatio: "16:9",
          aspectMode: "cover"
        },
        body: {
          type: "box",
          layout: "vertical",
          contents: [
            { type: "text", text: item.title, weight: "bold", size: "md", wrap: true },
            { type: "text", text: item.translated.slice(0, 450), size: "sm", wrap: true, margin: "md" }
          ]
        },
        footer: {
          type: "box",
          layout: "horizontal",
          contents: [
            {
              type: "button",
              style: "primary",
              height: "sm",
              action: {
                type: "uri",
                label: "üìñ ‡∏≠‡πà‡∏≤‡∏ô",
                uri: "https://news.watsaitama.com/liff-news.html?id=" + encodeURIComponent(item.link)
              }
            }
          ]
        }
      }));

      const flexMsg = {
        type: "flex",
        altText: "üì¢ ‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏≤‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠",
        contents: { type: "carousel", contents: bubbles }
      };

      try {
        await liff.init({ liffId: "1661018679-erv7N44z" });
        await liff.sendMessages([flexMsg]);
        document.getElementById("status").textContent = "‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!";
        liff.closeWindow();
      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = "‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message;
      }
    };

    fetchNews();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/th.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
  </head>
  <body class="bg-light text-dark">
    <div class="container py-4">
      <div id="newsContainer" class="card shadow-sm p-4">
        <h2 id="newsTitle" class="fw-bold text-success mb-3">
          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß...
        </h2>
        <p id="newsContent" class="fs-5"></p>
        <div class="text-muted mt-4" id="newsDate"></div>
        <div class="mt-3">
          <a
            id="originalLink"
            href="#"
            target="_blank"
            class="btn btn-outline-secondary btn-sm"
            >üîó ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</a
          >
        </div>
      </div>
    </div>

    <script>
      dayjs.locale("th");
      dayjs.extend(dayjs_plugin_relativeTime);

      function formatSmartThaiDate(isoDate) {
        const now = dayjs();
        const date = dayjs(isoDate);
        const isToday = now.isSame(date, "day");
        const isYesterday = now.subtract(1, "day").isSame(date, "day");

        if (isToday) {
          return `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏ß‡∏•‡∏≤ ${date.format("HH:mm")} ‡∏ô.`;
        } else if (isYesterday) {
          return `‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤ ${date.format("HH:mm")} ‡∏ô.`;
        } else {
          return date.format("D MMMM YYYY ‡πÄ‡∏ß‡∏•‡∏≤ HH:mm ‡∏ô.");
        }
      }

      const sheetApiUrl =
        "https://script.google.com/macros/s/AKfycbw7HEHW_mrgBUD-L1ogKs7r6XbbdenH6UwuS6W8XhUVeTeHci0gKW3IAOJ080YMc7PjGw/exec";
      const params = new URLSearchParams(window.location.search);
      const id = decodeURIComponent(params.get("id"));

      if (id) {
        fetch(`${sheetApiUrl}?link=${encodeURIComponent(id)}`)
          .then((res) => res.json())
          .then((data) => {
            if (data && data.translated) {
              document.getElementById("newsTitle").textContent = data.title;
              document.getElementById("newsContent").textContent =
                data.translated;
              document.getElementById(
                "newsDate"
              ).textContent = `‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${formatSmartThaiDate(
                data.pubDate
              )}`;
              document.getElementById("originalLink").href = data.link;
            } else {
              document.getElementById("newsTitle").textContent =
                "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö";
            }
          })
          .catch((err) => {
            console.error(err);
            document.getElementById("newsTitle").textContent =
              "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß";
          });
      } else {
        document.getElementById("newsTitle").textContent =
          "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡πà‡∏≤‡∏ß";
      }
    </script>
  </body>
</html>
